# 性能优化

## ❤如何进⾏⽹站性能优化
- content ⽅⾯ 
  - 减少 **HTTP** 请求：合并⽂件、 **CSS 精灵**、 **inline Image**
  - 减少 **DNS** 查询： DNS 缓存、将资源分布到恰当数量的主机名 
  - 减少 DOM 元素数量 按需加载，滚动加载
- Server ⽅⾯ 
  - 使⽤ **CDN**
  - 配置 **ETag**
  - 对组件使⽤ Gzip 压缩
- Cookie ⽅⾯ 
  - 减⼩ cookie ⼤⼩
- css ⽅⾯ 
  - 将样式表放到⻚⾯顶部 
  - 不使⽤ CSS 表达式 
  - 使⽤ <link> 不使⽤ @import
- Javascript ⽅⾯ 
  - 将脚本放到⻚⾯底部 
  - 将 javascript 和 css 从外部引⼊ 
  - 压缩 javascript 和 css
  - 删除不需要的脚本
  - 减少 **DOM** 访问 
- 图⽚⽅⾯ 
  - 优化图⽚：根据实际颜⾊需要选择⾊深、压缩 
  - 优化 css 精灵 
  - 不要在 HTML 中拉伸图⽚

## ❤优化性能之缓存处理
- dns 缓存 **域名解析成ip的过程**
  - 向DNS服务器发起解析域名的请求时，DNS服务器首先会查询自己的缓存中有没有该域名
  - 如果缓存中存在该域名，则可以直接返回IP地址。
  - 如果缓存中没有，服务器则会以递归的方式层层访问。
- cdn 缓存 **`Content Delivery Network`**  **【内容分发网络】**
  - CDN依靠**部署在各地的边缘服务器**，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取内容，降低网络延迟，提高访问速度。
  - 简单来讲，CDN是用来进行加速的，它可以让用户更快获得所需的数据
- CDN的工作过程
  - 1.DNS请求当地local DNS
  - 2.当地local DNS递归地查询服务器的gslb
  - 3.服务器根据local DNS 分配最佳节点，返回IP
  - 4.用户获得最佳接入IP，访问最佳节点。
  - 5.如果该节点没有用户想要获取的内容，则通过内部路由访问上一节点，直到找到文件或到达源站为止。
  - 6.CDN节点缓存该数据，下次请求该文件时可以直接返回。
- <ofont>浏览器缓存</ofont>

  - todu
- <ofont>服务器缓存</ofont>

##  ❤渲染优化

- 禁⽌使⽤ iframe （**阻塞⽗⽂档 onload 事件**）
  - iframe 会阻塞主⻚⾯的 Onload 事件
  - 搜索引擎的检索程序⽆法解读这种⻚⾯，不利于SEO
  - iframe 和主⻚⾯共享连接池，⽽浏览器对相同域的连接有限制，所以会影响⻚⾯的并⾏加载
  - 使⽤ iframe 之前需要考虑这两个缺点。如果需要使⽤ iframe ，最好是通过javascript
  - 动态给 iframe 添加 src 属性值，这样可以绕开以上两个问题
- 禁⽌使⽤ gif 图⽚实现 loading 效果（**降低 CPU 消耗，提升渲染性能**）
- 使⽤ <ofont>CSS3 代码代替 JS 动画（尽可能避免重绘重排以及回流）</ofont>
- 对于⼀些⼩图标，可以使⽤base64位编码，以减少⽹络请求。但不建议⼤图使⽤，⽐较耗费 CPU
  - ⼩图标优势在于
    - 减少 HTTP 请求
    - 避免⽂件跨域
    - 修改及时⽣效
- ⻚⾯头部的 `<style></style> <script></script>` 会阻塞⻚⾯；（因为 `Renderer` 进程中 `JS` 线程和渲染线程是互斥的）
- ⻚⾯中空的 href 和 src 会阻塞⻚⾯其他资源的加载 (阻塞下载进程)
- ⽹⻚  <ofont>gzip ， CDN 托管， data</ofont> 缓存 ，图⽚服务器
- 前端模板 JS+数据，减少由于 HTML 标签导致的带宽浪费，前端⽤变量保存AJAX请求结果，每次操作本地变量，不⽤请求，减少请求次数
- ⽤ <ofont>innerHTML 代替 DOM 操作，减少 DOM 操作次数，优化 javascript 性能</ofont>
- 当需要设置的样式很多时设置 **className** ⽽不是直接操作 **style**
- 少⽤全局变量、缓存 DOM 节点查找的结果。减少 IO 读取操作
- 图⽚预加载，将**样式表放在顶部，将脚本放在底部** 加上时间戳
- 对普通的⽹站有⼀个统⼀的思路，就是尽量向<ofont> 前端优化、减少数据库操作、减少磁盘 IO</ofont>



## ❤性能优化之【⼀个⻚⾯上有⼤量的图⽚（⼤型电商⽹站），加载很慢】

- 图⽚懒加载，在⻚⾯上的未可视区域可以添加⼀个滚动事件，判断图⽚位置与浏览器顶端的距离与⻚⾯的距离，如果前者⼩于后者，优先加载。
- 如果为幻灯⽚、相册等，可以使⽤**图⽚预加载技术**，将当前展示图⽚的前⼀张和后⼀张优先下载。
- 如果图⽚为css图⽚，可以使⽤ **CSSsprite ， SVGsprite ， Iconfont 、 Base64** 等技术。
- 如果图⽚过⼤，可以使⽤特殊编码的图⽚，加载时会先加载⼀张压缩的特别厉害的缩略图，以提⾼⽤户体验。
- 采用缩略图，列表界面采用缩略图，详情再展示大图
- 如果图⽚展示区域⼩于图⽚的真实⼤⼩，则因在服务器端根据业务需要先⾏进⾏图⽚压缩，图⽚压缩后⼤⼩与展示⼀致。

